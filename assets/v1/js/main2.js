(()=>{"use strict";const e=function(){const e=document.getElementById("install-banner"),t=document.getElementById("install-button"),n=document.getElementById("close-install-button");if(!e||!t||!n||"true"===localStorage.getItem("pwaInstallDismissed"))return;const s=(t=!1)=>{t&&localStorage.setItem("pwaInstallDismissed","true"),e.classList.remove("show"),e.addEventListener("transitionend",(()=>e.classList.add("d-none")),{once:!0})};window.addEventListener("beforeinstallprompt",(n=>{n.preventDefault();const a=n;e.classList.remove("d-none"),setTimeout((()=>e.classList.add("show")),50),t.addEventListener("click",(()=>{s(!0),a.prompt(),a.userChoice.then((e=>{"accepted"===e.outcome&&console.log("PWA installation accepted by user.")}))}),{once:!0})})),n.addEventListener("click",(()=>{s(!0)}))},t=function(){const e=document.querySelector(".movie-grid");if(!e||!e.dataset.path)return;let t=parseInt(e.dataset.page,10)||1;const n=e.dataset.path;let s=!1;const a=document.createElement("div");a.id="loader-container",a.className="col-12 text-center py-4",e.parentNode.appendChild(a);new IntersectionObserver((o=>{o[0].isIntersecting&&(async()=>{if(s||t>=50)t>=50&&!s&&(a.innerHTML='<p class="text-muted">No more results.</p>');else{s=!0,a.innerHTML='<div class="spinner-border text-secondary" role="status"><span class="sr-only"></span></div>';try{const s=t+1,o=new URL(n,window.location.origin);o.searchParams.set("page",s);const r=new URLSearchParams(window.location.search);r.has("lang")&&o.searchParams.set("lang",r.get("lang")),r.has("q")&&o.searchParams.set("q",r.get("q"));const l=await fetch(o.toString());if(!l.ok)throw new Error("HTTP error! status: "+l.status);const i=await l.text(),c=(new DOMParser).parseFromString(i,"text/html").querySelectorAll(".movie-grid > *");c.length>0?(c.forEach((t=>e.appendChild(t))),t++):(t=50,a.innerHTML='<p class="text-muted">No more results.</p>')}catch(e){console.error("Failed to load more content:",e),a.innerHTML='<p class="text-danger">Could not load more content.</p>'}finally{t<50&&(a.innerHTML=""),s=!1}}})()}),{rootMargin:"400px"}).observe(a)};window.play=e=>{const t=document.getElementById("player");t&&(t.src=e);const n=()=>{(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.resolve()).catch((e=>console.error("Error exiting fullscreen:",e)));const e=document.getElementById("staticBackdrop");if(e&&"undefined"!=typeof bootstrap&&bootstrap.Modal){const t=bootstrap.Modal.getOrCreateInstance(e);e.removeEventListener("hidden.bs.modal",s),e.addEventListener("hidden.bs.modal",s),t.show()}},s=()=>{setTimeout(n,1e4)};setTimeout(n,1e4)},document.addEventListener("DOMContentLoaded",(()=>{e(),(()=>{const e=document.getElementById("status-container");window.showStatus=(t,n="online",s=4e3)=>{for(;e.firstChild;)e.removeChild(e.firstChild);const a=document.createElement("div");a.className="status d-flex align-items-center p-3 rounded-3 shadow-lg "+n,a.innerHTML='<div class="status-icon flex-shrink-0" style="width: 32px; height: 32px;"></div><div class="ms-3 fw-medium">'+t+"</div>",e.appendChild(a),setTimeout((()=>a.classList.add("show")),100),setTimeout((()=>{a.parentNode&&(a.classList.remove("show"),a.addEventListener("transitionend",(()=>a.remove()),{once:!0}))}),s)},window.addEventListener("online",(()=>window.showStatus("Connected. You are back online!","online"))),window.addEventListener("offline",(()=>window.showStatus("Connection lost. You are now offline.","offline",5e3))),navigator.onLine||window.showStatus("You're currently offline.","still-offline",5e3)})(),"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/sw.js")})),function(){const e=document.getElementById("languageSelector"),t=document.getElementById("languageDropdown");if(!e||!t)return;const n=new URL(window.location.href),s=n.searchParams.get("lang")||"en",a=e.querySelector('a[data-lang="'+s+'"]');if(a){const e=a.getAttribute("data-flag"),n=a.textContent.trim();e&&n&&(t.innerHTML='<span class="fi fi-'+e+'"></span><span class="ms-2">'+n+"</span>")}e.addEventListener("click",(e=>{const t=e.target.closest("a[data-lang]");if(t){e.preventDefault();const s=t.getAttribute("data-lang");"en"===s?n.searchParams.delete("lang"):n.searchParams.set("lang",s),window.location.href=n.toString()}}))}(),t(),document.querySelectorAll('a[data-bs-toggle="collapse"]').forEach((e=>{const t=e.getAttribute("href"),n=document.querySelector(t);if(!n)return;const s=e.querySelector(".read-more"),a=e.querySelector(".read-less");s&&a&&(n.addEventListener("show.bs.collapse",(()=>{s.style.display="none",a.style.display="inline"})),n.addEventListener("hide.bs.collapse",(()=>{s.style.display="inline",a.style.display="none"})))})),document.addEventListener("error",(e=>{"IMG"!==e.target.tagName||e.target.dataset.fallback||(e.target.src="/no-image.svg",e.target.dataset.fallback="true")}),!0),function(){const e=document.getElementById("seasons-tab-pane"),t=document.getElementById("episodes-tab"),n=document.getElementById("episodes-tab-pane");e&&t&&n&&(e.addEventListener("click",(async s=>{const a=s.target.closest(".season-item"),o=s.target.closest("#load-more-seasons");if(a){s.preventDefault(),e.querySelectorAll(".season-item").forEach((e=>e.classList.remove("active"))),a.classList.add("active");const o=a.dataset.seasonNumber,r=a.dataset.tvId,l=(a.dataset.tvSlug,a.dataset.lang);t.textContent="Season "+o,n.innerHTML='<div class="d-flex justify-content-center mt-4"><div class="spinner-border text-secondary" role="status"><span class="visually-hidden">Loading...</span></div></div>',t.parentElement.style.display="block",new bootstrap.Tab(t).show();try{const e=window.location.origin+"/tv/"+r+"/season/"+o+"?lang="+l+"&partial=true",t=await fetch(e);if(!t.ok)throw new Error("HTTP error! status: "+t.status);const s=await t.text();n.innerHTML=s}catch(e){console.error("Failed to load episodes:",e),n.innerHTML='<p class="text-danger mt-3">Could not load episodes. Please try again later.</p>'}}o&&(s.preventDefault(),e.querySelectorAll(".season-item.d-none").forEach((e=>{e.classList.remove("d-none")})),o.style.display="none")})),n.addEventListener("click",(e=>{const t=e.target.closest(".episode-link");if(t){e.preventDefault(),n.querySelectorAll(".episode-link").forEach((e=>e.closest("li").classList.remove("active"))),t.closest("li").classList.add("active");const s="https://vidsrc.pm/embed/tv?tmdb="+t.dataset.tvId+"&season="+t.dataset.seasonNumber+"&episode="+t.dataset.episodeNumber+"&ds_lang="+t.dataset.lang,a=document.getElementById("watch-now-btn");a&&a.setAttribute("onclick","play('"+s+"')"),play(s)}})),document.body.addEventListener("click",(e=>{const t=e.target.closest('[data-action="load-more-episodes"]');if(t){e.preventDefault();const n=t.closest("ul");n&&n.querySelectorAll("[data-episode-item].d-none").forEach((e=>{e.classList.remove("d-none")})),t.parentElement&&(t.parentElement.style.display="none")}})))}(),function(){const e=document.querySelector(".search-form-minimal");if(!e)return;const t=e.querySelector('input[type="search"]'),n=e.querySelector(".search-results-container");let s;t.addEventListener("input",(e=>{clearTimeout(s);const t=e.target.value;t.length<3?n.style.display="none":s=setTimeout((async()=>{const e=new URLSearchParams(window.location.search).get("lang")||"en",s="/ajax/search?q="+encodeURIComponent(t)+"&lang="+e;try{const e=await fetch(s);if(!e.ok)throw new Error("Search request failed");const t=await e.text();n.innerHTML=t,n.style.display="block"}catch(e){console.error("AJAX search error:",e),n.innerHTML='<div class="p-3 text-center text-danger">Could not fetch results.</div>',n.style.display="block"}}),300)})),document.addEventListener("click",(t=>{e.contains(t.target)||(n.style.display="none")}))}()}))})();
