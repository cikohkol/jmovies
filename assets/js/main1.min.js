(()=>{"use strict";let e=function(){let e=document.getElementById("status-container"),t=null;window.showStatus=(t,a="online",n=8e3)=>{let s=document.createElement("div");s.className="status d-flex align-items-center p-3 rounded-3 shadow-lg",s.classList.add(a),s.innerHTML='<div class="status-icon flex-shrink-0" style="width: 32px; height: 32px;"></div><div class="ms-3 fw-medium">'+t+"</div>",e.appendChild(s),setTimeout(()=>{s.classList.add("show")},100),setTimeout(()=>{s.classList.remove("show"),s.addEventListener("transitionend",()=>s.remove(),{once:!0})},n)};let a=function(){t&&(clearInterval(t),t=null),window.showStatus("Connected. You are back online!","online")},n=function(){window.showStatus("Connection lost. You are offline.","offline",1e4),t||(t=setInterval(()=>{navigator.onLine?a():window.showStatus("You're still offline.","still-offline",5e3)},2e4))};window.addEventListener("online",a),window.addEventListener("offline",n),navigator.onLine||n()},t=function(){let e=document.getElementById("install-banner"),t=document.getElementById("install-button"),a=document.getElementById("close-install-button");if(!e||!t||!a||"true"===localStorage.getItem("pwaInstallDismissed"))return;let n=()=>{e.classList.remove("d-none"),setTimeout(()=>e.classList.add("show"),50)},s=(t=!1)=>{t&&localStorage.setItem("pwaInstallDismissed","true"),e.classList.remove("show"),e.addEventListener("transitionend",()=>e.classList.add("d-none"),{once:!0})};window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();let a=e;n(),t.addEventListener("click",()=>{s(!0),a.prompt(),a.userChoice.then(e=>{"accepted"===e.outcome&&console.log("PWA installation accepted by user.")})},{once:!0})}),a.addEventListener("click",()=>{s(!0)})},a=function(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js")})},n=function(){let e=document.getElementById("languageSelector"),t=document.getElementById("languageDropdown");if(!e||!t)return;let a=new URL(window.location.href),n=a.searchParams.get("lang")||"en",s=e.querySelector('a[data-lang="'+n+'"]');if(s){let l=s.getAttribute("data-flag"),r=s.textContent.trim();l&&r&&(t.innerHTML='<span class="fi fi-'+l+'"></span><span class="ms-2">'+r+"</span>")}e.addEventListener("click",e=>{let t=e.target.closest("a[data-lang]");if(t){e.preventDefault();let n=t.getAttribute("data-lang");"en"===n?a.searchParams.delete("lang"):a.searchParams.set("lang",n),window.location.href=a.toString()}})},s=function(){let e=document.querySelector(".movie-grid");if(!e||!e.dataset.path)return;let t=parseInt(e.dataset.page,10)||1,a=e.dataset.path,n=!1,s=document.createElement("div");s.id="loader-container",s.className="col-12 text-center py-4",e.parentNode.appendChild(s);let l=async()=>{if(n||t>=50){t>=50&&!n&&(s.innerHTML='<p class="text-muted">No more results.</p>');return}n=!0,s.innerHTML='<div class="spinner-grow text-secondary" role="status"><span class="sr-only"></span></div>';try{let l=t+1,r=new URL(a,window.location.origin);r.searchParams.set("page",l);let i=new URLSearchParams(window.location.search);i.has("lang")&&r.searchParams.set("lang",i.get("lang")),i.has("q")&&r.searchParams.set("q",i.get("q"));let o=await fetch(r.toString());if(!o.ok)throw Error("HTTP error! status: "+o.status);let d=await o.text(),c=new DOMParser,u=c.parseFromString(d,"text/html"),p=u.querySelectorAll(".movie-grid > *");p.length>0?(p.forEach(t=>e.appendChild(t)),t++):(t=50,s.innerHTML='<p class="text-muted">No more results.</p>')}catch(g){console.error("Failed to load more content:",g),s.innerHTML='<p class="text-danger">Could not load more content.</p>'}finally{t<50&&(s.innerHTML=""),n=!1}},r=new IntersectionObserver(e=>{e[0].isIntersecting&&l()},{rootMargin:"400px"});r.observe(s)},l=function(){document.querySelectorAll('a[data-bs-toggle="collapse"]').forEach(e=>{let t=e.getAttribute("href"),a=document.querySelector(t);if(!a)return;let n=e.querySelector(".read-more"),s=e.querySelector(".read-less");n&&s&&(a.addEventListener("show.bs.collapse",()=>{n.style.display="none",s.style.display="inline"}),a.addEventListener("hide.bs.collapse",()=>{n.style.display="inline",s.style.display="none"}))})},r=function(){let e=document.getElementById("seasons-tab-pane"),t=document.getElementById("episodes-tab"),a=document.getElementById("episodes-tab-pane");e&&t&&a&&(e.addEventListener("click",async n=>{let s=n.target.closest(".season-item"),l=n.target.closest("#load-more-seasons");if(s){n.preventDefault(),e.querySelectorAll(".season-item").forEach(e=>e.classList.remove("active")),s.classList.add("active");let r=s.dataset.seasonNumber,i=s.dataset.tvId;s.dataset.tvSlug;let o=s.dataset.lang;t.textContent="Season "+r,a.innerHTML='<div class="d-flex justify-content-center mt-4"><div class="spinner-grow text-secondary" role="status"><span class="visually-hidden">Loading...</span></div></div>',t.parentElement.style.display="block";let d=new bootstrap.Tab(t);d.show();try{let c=window.location.origin+"/tv/"+i+"/season/"+r+"?lang="+o+"&partial=true",u=await fetch(c);if(!u.ok)throw Error("HTTP error! status: "+u.status);let p=await u.text();a.innerHTML=p}catch(g){console.error("Failed to load episodes:",g),a.innerHTML='<p class="text-danger mt-3">Could not load episodes. Please try again later.</p>'}}l&&(n.preventDefault(),e.querySelectorAll(".season-item.d-none").forEach(e=>{e.classList.remove("d-none")}),l.style.display="none")}),a.addEventListener("click",e=>{let t=e.target.closest(".episode-link");if(t){e.preventDefault(),a.querySelectorAll(".episode-link").forEach(e=>e.closest("li").classList.remove("active")),t.closest("li").classList.add("active");let n=t.dataset.tvId,s=t.dataset.seasonNumber,l=t.dataset.episodeNumber,r=t.dataset.lang,i="https://vidsrc.pm/embed/tv?tmdb="+n+"&season="+s+"&episode="+l+"&ds_lang="+r,o=document.getElementById("watch-now-btn");o&&o.setAttribute("onclick","play('"+i+"')"),play(i)}}),document.body.addEventListener("click",e=>{let t=e.target.closest('[data-action="load-more-episodes"]');if(t){e.preventDefault();let a=t.closest("ul");a&&a.querySelectorAll("[data-episode-item].d-none").forEach(e=>{e.classList.remove("d-none")}),t.parentElement&&(t.parentElement.style.display="none")}}))},i=function(){let e=document.querySelector(".search-form-minimal");if(!e)return;let t=e.querySelector('input[type="search"]'),a=e.querySelector(".search-results-container"),n;t.addEventListener("input",e=>{clearTimeout(n);let t=e.target.value;if(t.length<3){a.style.display="none";return}n=setTimeout(async()=>{let e=new URLSearchParams(window.location.search),n=e.get("lang")||"en",s="/ajax/search?q="+encodeURIComponent(t)+"&lang="+n;try{let l=await fetch(s);if(!l.ok)throw Error("Search request failed");let r=await l.text();a.innerHTML=r,a.style.display="block"}catch(i){console.error("AJAX search error:",i),a.innerHTML='<div class="p-3 text-center text-danger">Could not fetch results.</div>',a.style.display="block"}},300)}),document.addEventListener("click",t=>{e.contains(t.target)||(a.style.display="none")})},o=function(){document.addEventListener("error",e=>{"IMG"!==e.target.tagName||e.target.dataset.fallback||(e.target.src="/no-image.svg",e.target.dataset.fallback="true")},!0)};window.play=e=>{let t=document.getElementById("player");t&&(t.src=e),setTimeout(()=>{let e=document.getElementById("staticBackdrop");if(e&&"undefined"!=typeof bootstrap&&bootstrap.Modal){let t=bootstrap.Modal.getOrCreateInstance(e);t.show()}document.fullscreenElement&&document.exitFullscreen().catch(e=>console.error(e))},9e4)},document.addEventListener("DOMContentLoaded",()=>{t(),e(),a(),n(),s(),l(),o(),r(),i()})})();
